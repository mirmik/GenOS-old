/*-------------------------------------------------
//
// Код инициализации и мультизагрузки
//  
//-----------------------------------------------*/


/*-------------------------------------------------
//    Константы для заголовка Multiboot
//-----------------------------------------------*/

.set MBOOT_HEADER_MAGIC, 0x1BADB002
.set MBOOT_HEADER_FLAGS, 0x00000001
.set MBOOT_CHECKSUM, - (0x1BADB003)

/* Указываем что функция main - внешняя и расположена в другом
 объектном модуле */

.extern main

/* Секция - заголовок мультизагрузки */
.section .mboot

.int MBOOT_HEADER_MAGIC
.int MBOOT_HEADER_FLAGS
.int MBOOT_CHECKSUM
 
/* Секция кода */
.section    .text

/* Делаем точку входа глобальной, доступной для компоновщика */
.global      boot

boot:
        cli /* Выключаем ВСЕ прерывания */
              
        push    %ebx /* Через этот регистр передается multiboot-структура */
                     /* поглужаем её в стек, чтобы в будущем воспользоваться */
                     /* в функции main */
      
        call    main /* вызываем boot2 */


        hlt /* Останавливаем процессор */
      
loop: /* Переходим в бесконечный цикл */
        jmp    loop

